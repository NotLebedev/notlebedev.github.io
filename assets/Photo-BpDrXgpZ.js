import{t as u,_ as C,u as B,I as W,s as w,a as N,i as $,b as J,c as p,S as H,M as S,d as K,e as X,f as b,o as D,g as Y,F as j,h as L,j as x,k as G,l as Z,m as O,n as ee,p as te,q as re,r as ne}from"./index-B839bF6D.js";import{d as oe,L as ie,g as le,a as se}from"./Debounce-BGYH5Thf.js";import{M as ce}from"./Metas-BvAMAC13.js";const ae=u('<svg><line x1="64" y1="192" x2="192" y2="64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></line></svg>',4,!0),ue=u('<svg><polyline points="88 64 192 64 192 168" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg>',4,!0),de=u('<svg><polygon points="88 64 192 64 192 168 88 64" opacity="0.2"></polygon></svg>',4,!0),he=u('<svg><line x1="64" y1="192" x2="140" y2="116" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></line></svg>',4,!0),ge=u('<svg><polygon points="88 64 192 64 192 168 88 64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></polygon></svg>',4,!0),ve=u('<svg><path d="M200,64V168a8,8,0,0,1-13.66,5.66L140,127.31,69.66,197.66a8,8,0,0,1-11.32-11.32L128.69,116,82.34,69.66A8,8,0,0,1,88,56H192A8,8,0,0,1,200,64Z"></path></svg>',4,!0),fe=u('<svg><line x1="64" y1="192" x2="192" y2="64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="12"></line></svg>',4,!0),me=u('<svg><polyline points="88 64 192 64 192 168" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="12"></polyline></svg>',4,!0),pe=u('<svg><line x1="64" y1="192" x2="192" y2="64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="8"></line></svg>',4,!0),we=u('<svg><polyline points="88 64 192 64 192 168" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="8"></polyline></svg>',4,!0),ye=u('<svg><line x1="64" y1="192" x2="192" y2="64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></line></svg>',4,!0),ke=u('<svg><polyline points="88 64 192 64 192 168" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></polyline></svg>',4,!0),_e=u('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect></svg>',4);var $e=function(e,n){switch(e){case"bold":return[ae.cloneNode(!0),ue.cloneNode(!0)];case"duotone":return[de.cloneNode(!0),he.cloneNode(!0),ge.cloneNode(!0)];case"fill":return ve.cloneNode(!0);case"light":return[fe.cloneNode(!0),me.cloneNode(!0)];case"thin":return[pe.cloneNode(!0),we.cloneNode(!0)];case"regular":return[ye.cloneNode(!0),ke.cloneNode(!0)];default:return console.error('Unsupported icon weight. Choose from "thin", "light", "regular", "bold", "fill", or "duotone".'),null}},xe=function(e,n){var i=e.color,t=e.size,l=e.weight,g=e.mirrored,v=e.children,_=C(e,["color","size","weight","mirrored","children"]),m=B(W),c=m.color,a=m.size,d=m.weight,s=m.mirrored,o=C(m,["color","size","weight","mirrored"]);return function(){var r=_e.cloneNode(!0),f=r.firstChild,y=n;return typeof y=="function"?y(r):n=r,w(r,"width",t??a),w(r,"height",t??a),w(r,"fill",i??c),w(r,"transform",g||s?"scale(-1, 1)":void 0),N(r,o,!0,!0),N(r,_,!0,!0),$(r,v,f),$(r,function(){return $e(l??d)},null),r}()};const Le=u('<svg><polyline points="88 136 112 160 168 104" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></polyline></svg>',4,!0),Ce=u('<svg><circle cx="128" cy="128" r="96" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="24"></circle></svg>',4,!0),Ne=u('<svg><circle cx="128" cy="128" r="96" opacity="0.2"></circle></svg>',4,!0),q=u('<svg><polyline points="88 136 112 160 168 104" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></polyline></svg>',4,!0),Q=u('<svg><circle cx="128" cy="128" r="96" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></circle></svg>',4,!0),Se=u('<svg><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm45.66,85.66-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35a8,8,0,0,1,11.32,11.32Z"></path></svg>',4,!0),Ie=u('<svg><polyline points="88 136 112 160 168 104" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="12"></polyline></svg>',4,!0),be=u('<svg><circle cx="128" cy="128" r="96" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="12"></circle></svg>',4,!0),je=u('<svg><polyline points="88 136 112 160 168 104" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="8"></polyline></svg>',4,!0),ze=u('<svg><circle cx="128" cy="128" r="96" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="8"></circle></svg>',4,!0),Pe=u('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect></svg>',4);var Ee=function(e,n){switch(e){case"bold":return[Le.cloneNode(!0),Ce.cloneNode(!0)];case"duotone":return[Ne.cloneNode(!0),q.cloneNode(!0),Q.cloneNode(!0)];case"fill":return Se.cloneNode(!0);case"light":return[Ie.cloneNode(!0),be.cloneNode(!0)];case"thin":return[je.cloneNode(!0),ze.cloneNode(!0)];case"regular":return[q.cloneNode(!0),Q.cloneNode(!0)];default:return console.error('Unsupported icon weight. Choose from "thin", "light", "regular", "bold", "fill", or "duotone".'),null}},Me=function(e,n){var i=e.color,t=e.size,l=e.weight,g=e.mirrored,v=e.children,_=C(e,["color","size","weight","mirrored","children"]),m=B(W),c=m.color,a=m.size,d=m.weight,s=m.mirrored,o=C(m,["color","size","weight","mirrored"]);return function(){var r=Pe.cloneNode(!0),f=r.firstChild,y=n;return typeof y=="function"?y(r):n=r,w(r,"width",t??a),w(r,"height",t??a),w(r,"fill",i??c),w(r,"transform",g||s?"scale(-1, 1)":void 0),N(r,o,!0,!0),N(r,_,!0,!0),$(r,v,f),$(r,function(){return Ee(l??d)},null),r}()};const Te="_grid_gw7ov_1",Re="_hidden_gw7ov_6",Ae="_gridItem_gw7ov_7",qe="_loading_gw7ov_9",Qe="_gridRow_gw7ov_14",Fe="_overlay_gw7ov_60",Ue="_fragmentIdentifier_gw7ov_69",Be="_gridFallback_gw7ov_83",We="_searchBox_gw7ov_126",He="_searchInput_gw7ov_132",De="_tagsList_gw7ov_153",Ge="_tagInList_gw7ov_160",k={grid:Te,hidden:Re,gridItem:Ae,loading:qe,gridRow:Qe,overlay:Fe,fragmentIdentifier:Ue,gridFallback:Be,searchBox:We,searchInput:He,tagsList:De,tagInList:Ge};class Ze{filters;data;constructor(e,...n){this.filters=n,this.data=e;for(const i of this.filters)i.createIndex(e)}filter(){const e=this.filters.map(t=>t.find()),n=[],i=this.data.length;for(let t=0;t<i;t++)this.checkMask(e,t)&&n.push(this.data[t]);return n}checkMask(e,n){return e.find(i=>!i[n])===void 0}}class P{currentQuery;keySelector;index;constructor(e){this.currentQuery=[],this.keySelector=e,this.index=[]}query(e){this.currentQuery=e.toLocaleLowerCase().split(" ")}createIndex(e){this.index=e.map(this.keySelector).map(n=>n.toLocaleLowerCase())}find(){const e=this.currentQuery,n=e.length,i=[],t=this.index.length;e:for(let l=0;l<t;l++){const g=this.index[l];for(let v=0;v<n;v++)if(!P.contains(e[v],g)){i.push(!1);continue e}i.push(!0)}return i}static contains(e,n){const i=e.length,t=n.length;e:for(let l=0,g=0;l<i;l++){const v=e.charCodeAt(l);for(;g<t;)if(n.charCodeAt(g++)===v)continue e;return!1}return!0}}class Oe{currentQuery;index;keySelector;constructor(e){this.currentQuery=new Set,this.index=[],this.keySelector=e}query(e){this.currentQuery=new Set(e)}createIndex(e){this.index=e.map(this.keySelector).map(n=>new Set(n))}find(){return this.index.map(e=>e.isSupersetOf(this.currentQuery))}}class z{static equal(e,n,i){if(e.length!==n.length)return!1;i=i??((l,g)=>l===g);const t=e.length;for(let l=0;l<t;l++)if(!i(e[l],n[l]))return!1;return!0}}class F{element;eventType;listener;constructor(e,n,i){this.element=e,this.eventType=n,this.listener=i,this.listener!==void 0&&this.element.addEventListener(this.eventType,this.listener)}setListener(e){this.removeListener(),this.listener=e,this.element.addEventListener(this.eventType,this.listener)}removeListener(){this.listener!==void 0&&this.element.removeEventListener(this.eventType,this.listener)}}var Ve=u("<a><div><div></div></div><div></div><img height=512 loading=lazy><div><p>"),Je=u("<div><svg height=512>"),Ke=u("<span><input type=text placeholder=Search...><ul>"),Xe=u("<li><input type=checkbox><label>"),U=u("<div>"),Ye=u("<p>Error loading images."),et=u("<p>Loading ...");function I(h){const e=[],i=Math.min(window.innerHeight/2,512)/512;let t=[],l=0;for(const g of h){const v=g.previewWidth*i;l+=v,t.push({info:g,type:"DisplayableImage"}),l>=window.innerWidth&&(e.push(t),t=[],l=0)}return t.length>0&&(t.push({width:window.innerWidth-l,type:"AlignmentPlaceholder"}),e.push(t)),e}const tt=h=>{const e=Z(),[n,i]=b(!1),t=oe(()=>i(!0),100);D(()=>t());let l;return(()=>{var g=Ve(),v=g.firstChild,_=v.firstChild,m=v.nextSibling,c=m.nextSibling,a=c.nextSibling,d=a.firstChild;$(m,p(ie,{})),c.addEventListener("load",()=>{i(!1),t.cancel(),l.className=""});var s=l;return typeof s=="function"?O(s,c):l=c,$(d,()=>h.info.name),$(a,p(xe,{size:"1.5rem"}),null),L(o=>{var r=k.gridItem,f=`/photo/${h.info.id}${e.search}`,y=k.fragmentIdentifier,E=h.info.id,V={[k.loading]:!0,[k.hidden]:!n()},M=h.info.previewWidth,T=le(h.info),R=k.hidden,A=k.overlay;return r!==o.e&&x(g,o.e=r),f!==o.t&&w(g,"href",o.t=f),y!==o.a&&x(v,o.a=y),E!==o.o&&w(_,"id",o.o=E),o.i=G(m,V,o.i),M!==o.n&&w(c,"width",o.n=M),T!==o.s&&w(c,"src",o.s=T),R!==o.h&&x(c,o.h=R),A!==o.r&&x(a,o.r=A),o},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),g})()},rt=h=>(()=>{var e=Je(),n=e.firstChild;return L(i=>{var t=k.gridItem,l=h.width;return t!==i.e&&x(e,i.e=t),l!==i.t&&w(n,"width",i.t=l),i},{e:void 0,t:void 0}),e})(),nt=h=>{const e=Z().query,n=ee();function i(c){ne(()=>{const a=new URLSearchParams(location.search);Object.entries(c).forEach(([s,o])=>{o==null||o===""?a.delete(s):a.set(s,String(o))});const d=a.toString();n(d?`?${d}`:"",{resolve:!0,scroll:!1,replace:!0})})}const t=new P(c=>c.name+" "+c.description+" "+c.tags.reduce((a,d)=>a+" "+d,"")),l=new Oe(c=>c.tags),g=te(()=>new Ze(h.images,t,l));re(c=>{t.query(e.search??""),l.query(e.tags?.split(",")??[]);const a=g().filter();return(c===void 0||!z.equal(c,a))&&h.displayResults(a),a},void 0);function v(c){const a=new Set(e.tags?.split(",")??[]);a.add(c),i({tags:[...a].join(",")})}function _(c){const a=new Set(e.tags?.split(",")??[]);a.delete(c),i({tags:[...a].join(",")})}function m(c){return e.tags?.split(",")?.includes(c)??!1}return(()=>{var c=Ke(),a=c.firstChild,d=a.nextSibling;return a.$$input=s=>i({search:s.target.value}),$(d,p(j,{get each(){return[...new Set(h.images.flatMap(s=>s.tags))]},children:s=>(()=>{var o=Xe(),r=o.firstChild,f=r.nextSibling;return r.addEventListener("change",y=>y.target.checked?v(s):_(s)),w(r,"id",`inputTag${s}`),w(f,"for",`inputTag${s}`),$(f,s,null),$(f,p(Me,{}),null),L(()=>x(o,k.tagInList)),L(()=>r.checked=m(s)),o})()})),L(s=>{var o=k.searchBox,r=k.searchInput,f=k.tagsList;return o!==s.e&&x(c,s.e=o),r!==s.t&&x(a,s.t=r),f!==s.a&&x(d,s.a=f),s},{e:void 0,t:void 0,a:void 0}),L(()=>a.value=e.search??""),c})()},ot=h=>{let e,n=[];const[i,t]=b(!1),[l,g]=b(I(n));let v,_;function m(d,s){return z.equal(d,s,(o,r)=>z.equal(o,r,(f,y)=>{switch(!0){case(f.type==="AlignmentPlaceholder"&&y.type==="AlignmentPlaceholder"):return!0;case(f.type==="DisplayableImage"&&y.type==="DisplayableImage"):return f.info===y.info;default:return!1}}))}function c(){if(n.length===0)return;const d=I(n);m(l(),d)||(v.setListener(()=>{g(d),t(!1),v.removeListener()}),t(!0))}D(()=>{window.addEventListener("resize",c),v=new F(e,"transitionend"),_=new F(e,"transitionend")}),Y(()=>{window.removeEventListener("resize",c),v.removeListener(),_.removeListener()});function a(d){const s=I(d);if(!m(l(),s)){if(n.length===0){n=d,g(s);return}_.setListener(o=>{o.target.tagName.toLowerCase()==="a"&&(n=d,g(s),t(!1),_.removeListener())}),t(!0)}}return[p(nt,{get images(){return h.db.images},displayResults:a}),(()=>{var d=U(),s=e;return typeof s=="function"?O(s,d):e=d,$(d,p(j,{get each(){return l()},children:o=>(()=>{var r=U();return $(r,p(j,{each:o,children:f=>p(H,{get children(){return[p(S,{get when(){return f.type=="DisplayableImage"},get children(){return p(tt,{get info(){return f.info}})}}),p(S,{get when(){return f.type=="AlignmentPlaceholder"},get children(){return p(rt,{get width(){return f.width}})}})]}})})),L(()=>x(r,k.gridRow)),r})()})),L(o=>G(d,{[k.grid]:!0,[k.hidden]:i()},o)),d})()]},ct=()=>{const[h]=J(se);return[p(ce,{title:"Photos"}),p(K,{get fallback(){return et()},get children(){return p(H,{get children(){return[p(S,{get when(){return h.error||h()===void 0},get children(){return Ye()}}),p(S,{when:!0,get children(){return p(ot,{get db(){return h()}})}})]}})}})]};X(["input"]);export{ct as default};
